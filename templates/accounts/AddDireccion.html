
{% extends 'base.html' %}
{% block content %}

{% include 'includes/sidebarnav.html' %}
<div class="col-span-9 mt-6 lg:mt-0 space-y-4">
    {% include 'includes/alerts.html' %}
    <div class="container">
 
    
<form action="{% url 'Agregardireccion' %}" method="POST">
    {% csrf_token %}
    <div class="grid gap-6 mb-6 md:grid-cols-2">
        <div>
            <label for="first_name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Detalle</label>
            <textarea id="Detalle" maxlength="100" name="Detalle" rows="4" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Detalle Su Ubicacion" required></textarea>
        </div>
        <div>
            <label for="last_name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Celular</label>
            <input type="number" maxlength="8" oninput="limitarNumero(this)"id="Celular" name="Celular" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="60600000" required>
        </div>
        <div class="flex items-center">
            <input id="Direccionenvio" name="Direccionenvio" value="Si" type="checkbox" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600" >
            <label for="link-checkbox" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Utilizar Como Direccion De Entrega</label>
        </div>
    </div>
    <div id="map-container" style="display: none;" >
        <span class="text-gray-600 font-semibold mt-5">Ubicacion:</span>
        <div class="flex-grow pl-3 mt-5">
          <div id="map" style="width: 100%; height: 400px;"></div>
          <input type="hidden" id="latitudInput" name="latitudInput"  placeholder="Latitud">
          <input type="hidden" id="longitudInput" name="longitudInput" placeholder="Longitud">
        </div>

      </div>
    <div class="text-center mt-5" id="map-button" style="display: none;">

        <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Registrar Ubicación</button>
    </div>
  
</form>

          
        </div>
        
    
</div>

<script src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAPS_API_KEY }}&callback=initMap" async defer></script>

<script>
    function limitarNumero(input) {
  const maxLength = 8; // Máxima longitud permitida
  if (input.value.length > maxLength) {
    input.value = input.value.slice(0, maxLength); // Truncar la entrada a 8 caracteres
  }
}

    function initMap() {
        var mapContainer = document.getElementById('map-container');
        var mapbutton = document.getElementById('map-button');
        
      if ("geolocation" in navigator) {
        // El navegador soporta geolocalización
        navigator.geolocation.getCurrentPosition(function (position) {
          // Se ha obtenido la ubicación del usuario
          var latitud = position.coords.latitude;
          var longitud = position.coords.longitude;
  
          // Crea un objeto de mapa de Google Maps y lo muestra en el elemento con el ID "map"
          var map = new google.maps.Map(document.getElementById('map'), {
            center: { lat: latitud, lng: longitud },
            zoom: 15 // Nivel de zoom
          });
  
          // Crea un marcador inicial en la ubicación del usuario
          var marker = new google.maps.Marker({
            position: { lat: latitud, lng: longitud },
            map: map,
            draggable: true // Permite que el marcador sea movible
          });
  
          // Obtén los elementos de entrada por su ID
          var latitudInput = document.getElementById('latitudInput');
          var longitudInput = document.getElementById('longitudInput');
          mapContainer.style.display = 'block';
          mapbutton.style.display = 'block';
          
          // Agrega un evento para escuchar cuando se arrastra el marcador
          marker.addListener('dragend', function (event) {
            var newLatitud = event.latLng.lat();
            var newLongitud = event.latLng.lng();
  
            // Actualiza el valor de los campos de entrada
            latitudInput.value = newLatitud;
            longitudInput.value = newLongitud;
          });
  
          // También puedes mostrar las coordenadas en los campos de entrada
          latitudInput.value = latitud;
          longitudInput.value = longitud;
        }, function (error) {
          // Manejar errores de geolocalización
          switch (error.code) {
            case error.PERMISSION_DENIED:
              console.error("El usuario ha denegado la solicitud de geolocalización.");
              break;
            case error.POSITION_UNAVAILABLE:
              console.error("La información de ubicación no está disponible.");
              break;
            case error.TIMEOUT:
              console.error("Se ha agotado el tiempo de espera para obtener la ubicación.");
              break;
            case error.UNKNOWN_ERROR:
              console.error("Se ha producido un error desconocido.");
              break;
          }
        });
      } else {
        // El navegador no soporta geolocalización
        console.error("La geolocalización no es compatible en este navegador.");
      }
    }
  
  
    initMap();
    document.addEventListener('DOMContentLoaded', function () {

      var mapContainer = document.getElementById('map-container');

  
    });
  
  
  
  </script>
  

{% endblock %}